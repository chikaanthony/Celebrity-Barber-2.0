<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Bookings - Celebrity Barber Admin</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Orbitron:wght@500;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            background: #0a0a12;
            min-height: 100vh;
            padding: 20px;
        }
        
        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(212, 175, 55, 0.3);
        }
        
        .page-header h1 {
            font-family: 'Orbitron', sans-serif;
            color: #d4af37;
            font-size: calc(24px * var(--mobile-font-scale, 1));
            margin: 0;
        }
        
        .back-btn {
            background: rgba(212, 175, 55, 0.2);
            color: #d4af37;
            border: 1px solid #d4af37;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-size: calc(14px * var(--mobile-font-scale, 1));
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .back-btn:hover {
            background: #d4af37;
            color: #0a0a12;
        }
        
        .stats-row {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            min-width: 150px;
            text-align: center;
        }
        
        .stat-card .stat-number {
            font-family: 'Orbitron', sans-serif;
            font-size: calc(28px * var(--mobile-font-scale, 1));
            color: #d4af37;
        }
        
        .stat-card .stat-label {
            color: #888;
            font-size: calc(14px * var(--mobile-font-scale, 1));
            margin-top: 5px;
        }
        
        .bookings-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .bookings-table th {
            background: rgba(212, 175, 55, 0.1);
            color: #d4af37;
            padding: 15px;
            text-align: left;
            font-family: 'Orbitron', sans-serif;
            font-size: calc(12px * var(--mobile-font-scale, 1));
        }
        
        .bookings-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #ccc;
        }
        
        .bookings-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: calc(11px * var(--mobile-font-scale, 1));
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-badge.pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }
        
        .status-badge.pending_approval {
            background: rgba(156, 39, 176, 0.2);
            color: #9c27b0;
        }
        
        .status-badge.confirmed {
            background: rgba(33, 150, 243, 0.2);
            color: #2196f3;
        }
        
        .status-badge.completed {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }
        
        .status-badge.cancelled {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state h2 {
            font-family: 'Orbitron', sans-serif;
            color: #d4af37;
            margin-bottom: 10px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: calc(14px * var(--mobile-font-scale, 1));
            margin-right: 5px;
            transition: all 0.3s;
        }
        
        .action-btn.confirm {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }
        
        .action-btn.confirm:hover {
            background: #4caf50;
            color: white;
        }
        
        .action-btn.decline {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }
        
        .action-btn.decline:hover {
            background: #f44336;
            color: white;
        }
    </style>
</head>
<body>
    <div class="page-header">
        <h1>üìÖ ALL BOOKINGS</h1>
        <a href="/admin" class="back-btn">‚Üê Back to Dashboard</a>
    </div>
    
    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-number">{{ bookings|length }}</div>
            <div class="stat-label">Total Bookings</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ bookings|selectattr('status', 'equalto', 'pending')|list|length }}</div>
            <div class="stat-label">Pending</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ bookings|selectattr('status', 'equalto', 'confirmed')|list|length }}</div>
            <div class="stat-label">Confirmed</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ bookings|selectattr('status', 'equalto', 'completed')|list|length }}</div>
            <div class="stat-label">Completed</div>
        </div>
    </div>
    
    {% if bookings %}
    <table class="bookings-table">
        <thead>
            <tr>
                <th>DATE</th>
                <th>CUSTOMER</th>
                <th>SERVICE</th>
                <th>PRICE</th>
                <th>STATUS</th>
                <th>CREATED</th>
                <th>ACTIONS</th>
            </tr>
        </thead>
        <tbody>
            {% for booking in bookings %}
            <tr onclick='showBookingDetails({{ booking | tojson }})' style="cursor: pointer;">
                <td>
                    {% if booking.booking_date %}
                    {{ booking.booking_date }}
                    {% else %}
                    N/A
                    {% endif %}
                </td>
                <td>
                    {% if booking.user_name %}
                    {{ booking.user_name }}
                    {% elif booking.name %}
                    {{ booking.name }}
                    {% else %}
                    {{ booking.user_id[:8] }}...
                    {% endif %}
                </td>
                <td>{{ booking.requests or booking.service or 'Haircut' }}</td>
                <td style="color: #d4af37;">‚Ç¶{{ booking.price or 0 }}</td>
                <td>
                    <span class="status-badge {{ booking.status }}">{{ booking.status }}</span>
                </td>
                <td>
                    {% if booking.createdAt %}
                    {{ booking.createdAt }}
                    {% else %}
                    Recently
                    {% endif %}
                </td>
                <td>
                    {% if booking.status == 'pending' %}
                    <button class="action-btn confirm" onclick="updateStatus('{{ booking.id }}', 'confirm')">‚úì</button>
                    <button class="action-btn decline" onclick="updateStatus('{{ booking.id }}', 'cancel')">‚úï</button>
                    {% else %}
                    -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <h2>üìÖ No Bookings Yet</h2>
        <p>There are no bookings in the system.</p>
    </div>
    {% endif %}
    
    <script>
        async function updateStatus(bookingId, newStatus) {
            if (!confirm('Are you sure you want to ' + newStatus + ' this booking?')) {
                return;
            }
            
            try {
                const response = await fetch('/api/admin/approve-booking', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        bookingId: bookingId,
                        action: newStatus
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Booking ' + newStatus + ' successfully!');
                    location.reload();
                } else {
                    alert('Error: ' + (result.message || 'Failed to update booking'));
                }
            } catch (error) {
                console.error('Error updating booking:', error);
                alert('Error updating booking. Please try again.');
            }
        }
        
        function showBookingDetails(booking) {
            document.getElementById('detailId').textContent = booking.id || 'N/A';
            document.getElementById('detailCustomer').textContent = booking.user_name || booking.name || 'N/A';
            document.getElementById('detailEmail').textContent = booking.user_email || 'N/A';
            document.getElementById('detailService').textContent = booking.requests || booking.service || 'Haircut';
            document.getElementById('detailPrice').textContent = '‚Ç¶' + (booking.price || 0);
            document.getElementById('detailDate').textContent = booking.booking_date || 'N/A';
            document.getElementById('detailStatus').textContent = booking.status;
            document.getElementById('detailStatus').className = 'status-badge ' + booking.status;
            document.getElementById('detailCreated').textContent = booking.createdAt || 'Recently';
            
            // Show/hide action buttons based on status
            const actionsDiv = document.getElementById('detailActions');
            if (booking.status === 'pending') {
                actionsDiv.style.display = 'block';
                actionsDiv.dataset.bookingId = booking.id;
            } else {
                actionsDiv.style.display = 'none';
            }
            
            document.getElementById('bookingModal').style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('bookingModal').style.display = 'none';
        }
        
        function confirmFromModal() {
            const bookingId = document.getElementById('detailActions').dataset.bookingId;
            if (bookingId) {
                updateStatus(bookingId, 'confirm');
                closeModal();
            }
        }
        
        function declineFromModal() {
            const bookingId = document.getElementById('detailActions').dataset.bookingId;
            if (bookingId) {
                updateStatus(bookingId, 'cancelled');
                closeModal();
            }
        }
    </script>
    
    <!-- Booking Details Modal -->
    <div id="bookingModal" class="modal-overlay" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">‚úï</button>
            
            <div class="modal-header">
                <h2>BOOKING DETAILS</h2>
            </div>
            
            <div class="modal-body">
                <div class="detail-row">
                    <span class="detail-label">Booking ID:</span>
                    <span class="detail-value" id="detailId"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Customer:</span>
                    <span class="detail-value" id="detailCustomer"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value" id="detailEmail"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Service:</span>
                    <span class="detail-value" id="detailService"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Price:</span>
                    <span class="detail-value" id="detailPrice"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Booking Date:</span>
                    <span class="detail-value" id="detailDate"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Status:</span>
                    <span class="detail-value"><span id="detailStatus" class="status-badge"></span></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Created:</span>
                    <span class="detail-value" id="detailCreated"></span>
                </div>
                
                <div id="detailActions" class="modal-actions" style="display: none;">
                    <button class="action-btn decline" onclick="declineFromModal()">‚úï DECLINE</button>
                    <button class="action-btn confirm" onclick="confirmFromModal()">‚úì CONFIRM</button>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #1a1a1a;
            border: 1px solid #d4af37;
            border-radius: 15px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #888;
            font-size: calc(20px * var(--mobile-font-scale, 1));
            cursor: pointer;
        }
        
        .modal-close:hover {
            color: #d4af37;
        }
        
        .modal-header h2 {
            font-family: 'Orbitron', sans-serif;
            color: #d4af37;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .detail-label {
            color: #888;
        }
        
        .detail-value {
            color: #fff;
            font-weight: 500;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .modal-actions .action-btn {
            flex: 1;
            padding: 12px;
            font-size: calc(14px * var(--mobile-font-scale, 1));
        }
    </style>
</body>
</html>
