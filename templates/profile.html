<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Celebrity Barber</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='profile.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="profile-container">
        <!-- Close Button -->
        <button class="close-btn" onclick="window.location.href='/clientdashboard'">‚úï</button>
        
        <!-- Profile Header -->
        <h1 class="page-title">MY PROFILE</h1>
        <hr class="header-separator">
        
        <!-- Profile Picture Section -->
        <div class="profile-picture-section">
            <div class="current-avatar" id="currentAvatar">
                <img id="avatarImage" src="" alt="Profile Photo" style="display: none;">
                <span id="avatarEmoji" class="avatar-emoji">üë§</span>
                <div class="avatar-overlay" onclick="document.getElementById('photoInput').click()">
                    <span>üì∑</span>
                </div>
            </div>
            <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
            
            <div class="profile-actions">
                <button class="action-btn change-btn" onclick="document.getElementById('photoInput').click()">
                    <span>üì∑</span> Change Photo
                </button>
                <button class="action-btn delete-btn" onclick="deletePhoto()">
                    <span>üóëÔ∏è</span> Delete
                </button>
            </div>
        </div>
        
        <!-- Preview Modal -->
        <div class="preview-modal" id="previewModal" style="display: none;">
            <div class="preview-content">
                <span class="preview-title">Preview New Photo</span>
                <img id="previewImage" src="" alt="Preview">
                <div class="preview-actions">
                    <button class="btn-cancel" onclick="cancelUpload()">Cancel</button>
                    <button class="btn-save" onclick="savePhoto()">Save Photo</button>
                </div>
            </div>
        </div>
        
        <!-- User Info Form -->
        <form class="profile-form" onsubmit="updateProfile(event)">
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="fullName" value="{{ user.full_name if user else 'User' }}">
            </div>
            
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="email" value="{{ user.email if user else 'user@example.com' }}" disabled>
            </div>
            
            <div class="form-group">
                <label>Phone Number</label>
                <input type="tel" id="phone" placeholder="Enter phone number" value="{{ user.phone if user else '' }}">
            </div>
            
            <div class="form-group">
                <label>Address</label>
                <input type="text" id="address" placeholder="Enter address" value="{{ user.address if user else '' }}">
            </div>
            
            <button type="submit" class="save-btn">Save Changes</button>
        </form>
        
        <!-- Success Message -->
        <div class="success-toast" id="successToast">
            <span>‚úì</span> Profile updated successfully!
        </div>
    </div>
    
    <script>
        // Initialize profile photo from sessionStorage or use default
        let currentPhoto = sessionStorage.getItem('profilePhoto') || null;
        let pendingPhoto = null;
        
        // Initialize on load
        window.onload = function() {
            updateAvatarDisplay();
        };
        
        function updateAvatarDisplay() {
            const avatarImage = document.getElementById('avatarImage');
            const avatarEmoji = document.getElementById('avatarEmoji');
            
            if (currentPhoto) {
                avatarImage.src = currentPhoto;
                avatarImage.style.display = 'block';
                avatarEmoji.style.display = 'none';
            } else {
                avatarImage.style.display = 'none';
                avatarEmoji.style.display = 'flex';
            }
        }
        
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Image must be less than 5MB');
                return;
            }
            
            // Read and preview the image
            const reader = new FileReader();
            reader.onload = function(e) {
                pendingPhoto = e.target.result;
                showPreview(e.target.result);
            };
            reader.readAsDataURL(file);
        }
        
        function showPreview(photoData) {
            const modal = document.getElementById('previewModal');
            const previewImage = document.getElementById('previewImage');
            
            previewImage.src = photoData;
            modal.style.display = 'flex';
        }
        
        function cancelUpload() {
            document.getElementById('previewModal').style.display = 'none';
            document.getElementById('photoInput').value = '';
            pendingPhoto = null;
        }
        
        function savePhoto() {
            currentPhoto = pendingPhoto;
            sessionStorage.setItem('profilePhoto', currentPhoto);
            updateAvatarDisplay();
            
            document.getElementById('previewModal').style.display = 'none';
            document.getElementById('photoInput').value = '';
            pendingPhoto = null;
            
            showSuccessToast('Profile photo updated!');
        }
        
        function deletePhoto() {
            if (!currentPhoto) {
                alert('No photo to delete');
                return;
            }
            
            if (confirm('Are you sure you want to delete your profile photo?')) {
                currentPhoto = null;
                sessionStorage.removeItem('profilePhoto');
                updateAvatarDisplay();
                showSuccessToast('Profile photo deleted');
            }
        }
        
        function updateProfile(event) {
            event.preventDefault();
            
            const fullName = document.getElementById('fullName').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            
            // Here you would typically save to database
            // For now, we show success
            showSuccessToast('Profile updated successfully!');
        }
        
        function showSuccessToast(message) {
            const toast = document.getElementById('successToast');
            toast.textContent = '‚úì ' + message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
